{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { ref, reactive } from 'vue';\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue';\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue';\nimport ModalVerMantenciones from '@/components/MantencionesUi/ModalVerMantenciones.vue';\nexport default {\n  __name: 'MantencionesView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const patenteSeleccionada = ref('');\n    const selectedVehiculo = ref(null);\n    const mantencionSeleccionada = ref(null); // Para editar\n\n    const showAddModal = ref(false);\n    const showVerModal = ref(false);\n\n    // ✅ Usar reactive en lugar de ref\n    const mantencionesPorPatente = reactive({});\n\n    // Lista inicial de vehículos\n    const mantenciones = ref([{\n      patente: 'ABC123',\n      odometro: 4500,\n      estado: 'OK'\n    }, {\n      patente: 'XYZ789',\n      odometro: 72000,\n      estado: 'Requiere mantención'\n    }, {\n      patente: 'DEF456',\n      odometro: 60000,\n      estado: 'Próxima mantención'\n    }]);\n    function abrirModal(item) {\n      selectedVehiculo.value = item;\n      patenteSeleccionada.value = item.patente;\n      if (!mantencionesPorPatente[item.patente]) {\n        mantencionesPorPatente[item.patente] = [];\n      }\n      mantencionSeleccionada.value = null;\n      showAddModal.value = true;\n    }\n    function cerrarModal() {\n      showAddModal.value = false;\n      selectedVehiculo.value = null;\n      mantencionSeleccionada.value = null;\n    }\n    function verMantenciones(item) {\n      patenteSeleccionada.value = item.patente;\n      showVerModal.value = true;\n    }\n\n    // Guardar mantención (nuevo o editar)\n    function guardarMantencion(maintenance) {\n      const patente = patenteSeleccionada.value;\n      console.log('[Padre] guardarMantencion →', patente, maintenance);\n\n      // Crear array reactivamente si no existe\n      if (!mantencionesPorPatente[patente]) {\n        mantencionesPorPatente[patente] = [];\n        console.log('[Padre] creada lista para', patente);\n      }\n      const mantencionesVehiculo = mantencionesPorPatente[patente];\n\n      // Normalizar nombre para comparar\n      const nombreNuevo = (maintenance.nombre || maintenance.name || '').toString().trim().toLowerCase();\n      const tipoNuevo = (maintenance.tipo || maintenance.type || '').toString().trim().toLowerCase();\n      if (mantencionSeleccionada.value !== null) {\n        // EDITANDO -> permitir actualizar (pero evitar que cambies a otro nombre ya existente)\n        const editingIndex = mantencionSeleccionada.value;\n        const existeOtro = mantencionesVehiculo.some((m, idx) => {\n          if (idx === editingIndex) return false; // ignora el propio\n          const nombreExist = (m.nombre || m.name || '').toString().trim().toLowerCase();\n          const tipoExist = (m.tipo || m.type || '').toString().trim().toLowerCase();\n          return nombreExist === nombreNuevo && tipoExist === tipoNuevo;\n        });\n        if (existeOtro) {\n          alert(`⚠️ No se puede editar: ya existe otra mantención con el mismo nombre/tipo para esta patente.`);\n          return;\n        }\n        console.log('[Padre] editando índice', editingIndex);\n        mantencionesVehiculo[editingIndex] = maintenance;\n      } else {\n        // AGREGANDO -> bloquear si ya existe nombre+tipo\n        const existe = mantencionesVehiculo.some(m => {\n          const nombreExist = (m.nombre || m.name || '').toString().trim().toLowerCase();\n          const tipoExist = (m.tipo || m.type || '').toString().trim().toLowerCase();\n          return nombreExist === nombreNuevo && tipoExist === tipoNuevo;\n        });\n        if (existe) {\n          alert(`⚠️ Ya existe una mantención \"${maintenance.nombre || maintenance.name}\" de ese tipo para esta patente.`);\n          return;\n        }\n        console.log('[Padre] agregando nueva mantención');\n        mantencionesVehiculo.push(maintenance);\n      }\n\n      // Forzar log legible (reactive)\n      console.log('[Padre] mantencionesPorPatente actual:', JSON.parse(JSON.stringify(mantencionesPorPatente)));\n      // cerrar modal y resetear selección de edición\n      cerrarModal();\n    }\n\n    // Editar desde ModalVerMantenciones\n    function editarMantencion(idx) {\n      const patente = patenteSeleccionada.value;\n      if (!mantencionesPorPatente[patente]) {\n        mantencionesPorPatente[patente] = [];\n      }\n      mantencionSeleccionada.value = idx;\n      selectedVehiculo.value = {\n        patente,\n        odometro: selectedVehiculo.value?.odometro || 0\n      };\n      showAddModal.value = true;\n    }\n\n    // Eliminar desde ModalVerMantenciones\n    function eliminarMantencion(idx) {\n      const patente = patenteSeleccionada.value;\n      mantencionesPorPatente[patente].splice(idx, 1);\n    }\n    const __returned__ = {\n      patenteSeleccionada,\n      selectedVehiculo,\n      mantencionSeleccionada,\n      showAddModal,\n      showVerModal,\n      mantencionesPorPatente,\n      mantenciones,\n      abrirModal,\n      cerrarModal,\n      verMantenciones,\n      guardarMantencion,\n      editarMantencion,\n      eliminarMantencion,\n      ref,\n      reactive,\n      MantencionesTable,\n      ModalAgregar,\n      ModalVerMantenciones\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","MantencionesTable","ModalAgregar","ModalVerMantenciones","patenteSeleccionada","selectedVehiculo","mantencionSeleccionada","showAddModal","showVerModal","mantencionesPorPatente","mantenciones","patente","odometro","estado","abrirModal","item","value","cerrarModal","verMantenciones","guardarMantencion","maintenance","console","log","mantencionesVehiculo","nombreNuevo","nombre","name","toString","trim","toLowerCase","tipoNuevo","tipo","type","editingIndex","existeOtro","some","m","idx","nombreExist","tipoExist","alert","existe","push","JSON","parse","stringify","editarMantencion","eliminarMantencion","splice"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/MantencionesView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2\">\n    <MantencionesTable :mantenciones=\"mantenciones\" @ver-mantenciones=\"verMantenciones\"\n      @agregar-mantencion=\"abrirModal\" />\n\n    <ModalAgregar :show-add-modal=\"showAddModal\" :selected-patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\"\n      :selected-mantencion=\"mantencionSeleccionada\" @close=\"cerrarModal\" @save=\"guardarMantencion\" />\n\n    <ModalVerMantenciones v-if=\"showVerModal\" :patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\" @close=\"showVerModal = false\"\n      @editar=\"editarMantencion\" @eliminar=\"eliminarMantencion\" />\n\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue'\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue'\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue'\nimport ModalVerMantenciones from '@/components/MantencionesUi/ModalVerMantenciones.vue'\n\nconst patenteSeleccionada = ref('')\nconst selectedVehiculo = ref(null)\nconst mantencionSeleccionada = ref(null) // Para editar\n\nconst showAddModal = ref(false)\nconst showVerModal = ref(false)\n\n// ✅ Usar reactive en lugar de ref\nconst mantencionesPorPatente = reactive({})\n\n// Lista inicial de vehículos\nconst mantenciones = ref([\n  { patente: 'ABC123', odometro: 4500, estado: 'OK' },\n  { patente: 'XYZ789', odometro: 72000, estado: 'Requiere mantención' },\n  { patente: 'DEF456', odometro: 60000, estado: 'Próxima mantención' },\n])\n\nfunction abrirModal(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n\n  if (!mantencionesPorPatente[item.patente]) {\n    mantencionesPorPatente[item.patente] = []\n  }\n\n  mantencionSeleccionada.value = null\n  showAddModal.value = true\n}\n\n\nfunction cerrarModal() {\n  showAddModal.value = false\n  selectedVehiculo.value = null\n  mantencionSeleccionada.value = null\n}\n\nfunction verMantenciones(item) {\n  patenteSeleccionada.value = item.patente\n  showVerModal.value = true\n}\n\n// Guardar mantención (nuevo o editar)\nfunction guardarMantencion(maintenance) {\n  const patente = patenteSeleccionada.value\n  console.log('[Padre] guardarMantencion →', patente, maintenance)\n\n  // Crear array reactivamente si no existe\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n    console.log('[Padre] creada lista para', patente)\n  }\n\n  const mantencionesVehiculo = mantencionesPorPatente[patente]\n\n  // Normalizar nombre para comparar\n  const nombreNuevo = (maintenance.nombre || maintenance.name || '').toString().trim().toLowerCase()\n  const tipoNuevo = (maintenance.tipo || maintenance.type || '').toString().trim().toLowerCase()\n\n  if (mantencionSeleccionada.value !== null) {\n    // EDITANDO -> permitir actualizar (pero evitar que cambies a otro nombre ya existente)\n    const editingIndex = mantencionSeleccionada.value\n    const existeOtro = mantencionesVehiculo.some((m, idx) => {\n      if (idx === editingIndex) return false // ignora el propio\n      const nombreExist = (m.nombre || m.name || '').toString().trim().toLowerCase()\n      const tipoExist = (m.tipo || m.type || '').toString().trim().toLowerCase()\n      return nombreExist === nombreNuevo && tipoExist === tipoNuevo\n    })\n    if (existeOtro) {\n      alert(`⚠️ No se puede editar: ya existe otra mantención con el mismo nombre/tipo para esta patente.`)\n      return\n    }\n\n    console.log('[Padre] editando índice', editingIndex)\n    mantencionesVehiculo[editingIndex] = maintenance\n  } else {\n    // AGREGANDO -> bloquear si ya existe nombre+tipo\n    const existe = mantencionesVehiculo.some(m => {\n      const nombreExist = (m.nombre || m.name || '').toString().trim().toLowerCase()\n      const tipoExist = (m.tipo || m.type || '').toString().trim().toLowerCase()\n      return nombreExist === nombreNuevo && tipoExist === tipoNuevo\n    })\n\n    if (existe) {\n      alert(`⚠️ Ya existe una mantención \"${maintenance.nombre || maintenance.name}\" de ese tipo para esta patente.`)\n      return\n    }\n\n    console.log('[Padre] agregando nueva mantención')\n    mantencionesVehiculo.push(maintenance)\n  }\n\n  // Forzar log legible (reactive)\n  console.log('[Padre] mantencionesPorPatente actual:', JSON.parse(JSON.stringify(mantencionesPorPatente)))\n  // cerrar modal y resetear selección de edición\n  cerrarModal()\n}\n\n\n// Editar desde ModalVerMantenciones\nfunction editarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n  }\n\n  mantencionSeleccionada.value = idx\n  selectedVehiculo.value = { patente, odometro: selectedVehiculo.value?.odometro || 0 }\n  showAddModal.value = true\n}\n\n// Eliminar desde ModalVerMantenciones\nfunction eliminarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n  mantencionesPorPatente[patente].splice(idx, 1)\n}\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}