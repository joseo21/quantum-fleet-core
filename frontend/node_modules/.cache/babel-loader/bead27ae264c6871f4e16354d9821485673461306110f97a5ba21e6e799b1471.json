{"ast":null,"code":"import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-2\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode($setup[\"MantencionesTable\"], {\n    mantenciones: $setup.mantenciones,\n    onVerMantenciones: $setup.verMantenciones,\n    onAgregarMantencion: $setup.abrirModal\n  }), _createVNode($setup[\"ModalAgregar\"], {\n    \"show-add-modal\": $setup.showAddModal,\n    \"selected-patente\": $setup.patenteSeleccionada,\n    mantenciones: $setup.mantencionesPorPatente[$setup.patenteSeleccionada] || [],\n    \"selected-mantencion\": $setup.mantencionSeleccionada,\n    \"km-actual\": $setup.selectedVehiculo?.odometro || 0,\n    onClose: $setup.cerrarModal,\n    onSave: $setup.guardarMantencion\n  }, null, 8 /* PROPS */, [\"show-add-modal\", \"selected-patente\", \"mantenciones\", \"selected-mantencion\", \"km-actual\"]), $setup.showVerModal ? (_openBlock(), _createBlock($setup[\"ModalVerMantenciones\"], {\n    key: 0,\n    patente: $setup.patenteSeleccionada,\n    mantenciones: $setup.mantencionesPorPatente[$setup.patenteSeleccionada] || [],\n    \"odometro-actual\": $setup.selectedVehiculo?.odometro || 0,\n    \"horometros-actuales\": $setup.horometrosActuales,\n    onClose: _cache[0] || (_cache[0] = $event => $setup.showVerModal = false),\n    onEditar: $setup.editarMantencion,\n    onEliminar: $setup.eliminarMantencion\n  }, null, 8 /* PROPS */, [\"patente\", \"mantenciones\", \"odometro-actual\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","$setup","mantenciones","onVerMantenciones","verMantenciones","onAgregarMantencion","abrirModal","showAddModal","patenteSeleccionada","mantencionesPorPatente","mantencionSeleccionada","selectedVehiculo","odometro","onClose","cerrarModal","onSave","guardarMantencion","showVerModal","_createBlock","patente","horometrosActuales","_cache","$event","onEditar","editarMantencion","onEliminar","eliminarMantencion"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/MantencionesView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2\">\n    <MantencionesTable :mantenciones=\"mantenciones\" @ver-mantenciones=\"verMantenciones\"\n      @agregar-mantencion=\"abrirModal\" />\n\n    <ModalAgregar :show-add-modal=\"showAddModal\" :selected-patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\" :selected-mantencion=\"mantencionSeleccionada\"\n      :km-actual=\"selectedVehiculo?.odometro || 0\" @close=\"cerrarModal\" @save=\"guardarMantencion\" />\n\n\n    <ModalVerMantenciones v-if=\"showVerModal\" :patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\"\n      :odometro-actual=\"selectedVehiculo?.odometro || 0\" :horometros-actuales=\"horometrosActuales\"\n      @close=\"showVerModal = false\" @editar=\"editarMantencion\" @eliminar=\"eliminarMantencion\" />\n\n\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue'\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue'\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue'\nimport ModalVerMantenciones from '@/components/MantencionesUi/ModalVerMantenciones.vue'\n\n// ------------------------------\n// 游댳 Variables reactivas principales\n// ------------------------------\nconst patenteSeleccionada = ref('')              // Guarda la patente del veh칤culo actualmente seleccionado\nconst selectedVehiculo = ref(null)               // Guarda los datos del veh칤culo al que se le est치 agregando/editar una mantenci칩n\nconst mantencionSeleccionada = ref(null)         // 칈ndice de la mantenci칩n que se est치 editando\n\nconst showAddModal = ref(false)                  // Controla la visibilidad del modal de agregar/editar\nconst showVerModal = ref(false)                  // Controla la visibilidad del modal de ver mantenciones\n\n// 游댳 Diccionario reactivo que guarda las mantenciones por veh칤culo (clave = patente)\nconst mantencionesPorPatente = reactive({})\n\n// ------------------------------\n// 游댳 Lista principal de veh칤culos\n// ------------------------------\nconst mantenciones = [\n  { patente: 'GHI901 - N춿1', odometro: 12500, estado: 'OK' },\n  { patente: 'JKL234 - N춿2', odometro: 98500, estado: 'Requiere mantenci칩n' },\n  { patente: 'MNO567 - N춿3', odometro: 35000, estado: 'Pr칩xima mantenci칩n' },\n  { patente: 'PQR890 - N춿4', odometro: 21000, estado: 'OK' },\n  { patente: 'STU12A - N춿5', odometro: 110000, estado: 'Requiere mantenci칩n' },\n  { patente: 'VWX34B - N춿6', odometro: 48000, estado: 'Pr칩xima mantenci칩n' },\n  { patente: 'YZA67C - N춿7', odometro: 6000, estado: 'OK' },\n  { patente: 'BCD90D - N춿8', odometro: 155000, estado: 'Requiere mantenci칩n' },\n  { patente: 'EFG23E - N춿9', odometro: 75500, estado: 'Pr칩xima mantenci칩n' },\n  { patente: 'HIJ56F - N춿10', odometro: 1900, estado: 'OK' },\n];\nconst horometrosActuales = {\n  'ABC123': 145,   // veh칤culo 1\n  'XYZ789': 230,  // veh칤culo 2\n  'DEF456': 87,   // veh칤culo 3\n}\n// ------------------------------\n// 游댳 Abrir modal para agregar o editar mantenci칩n\n// ------------------------------\nfunction abrirModal(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n\n  // Si no existe una lista de mantenciones para esa patente, se crea\n  if (!mantencionesPorPatente[item.patente]) {\n    mantencionesPorPatente[item.patente] = []\n  }\n\n  mantencionSeleccionada.value = null\n  showAddModal.value = true\n}\n\n// ------------------------------\n// 游댳 Cerrar modal de agregar/editar\n// ------------------------------\nfunction cerrarModal() {\n  showAddModal.value = false\n  selectedVehiculo.value = null\n  mantencionSeleccionada.value = null\n}\n\n// ------------------------------\n// 游댳 Abrir modal de visualizaci칩n de mantenciones\n// ------------------------------\nfunction verMantenciones(item) {\n  patenteSeleccionada.value = item.patente\n  showVerModal.value = true\n}\n\n// ------------------------------\n// 游댳 Guardar mantenci칩n (nuevo registro o edici칩n existente)\n// ------------------------------\nfunction guardarMantencion(maintenance) {\n  // 游눠 La patente se obtiene directamente del objeto emitido\n  const patente = maintenance.patente\n\n  // Si no existe una lista para esa patente, se crea reactivamente\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n  }\n\n  const mantencionesVehiculo = mantencionesPorPatente[patente]\n\n  // 游눠 Obtener el 칤ndice para edici칩n del objeto emitido\n  const editingIndex = maintenance.editingIndex\n\n  // Si se est치 editando, reemplaza el registro\n  if (editingIndex !== null) {\n    // Aseg칰rate de quitar la propiedad temporal 'editingIndex'\n    delete maintenance.editingIndex;\n    mantencionesVehiculo[editingIndex] = maintenance\n  }\n  // Si es una nueva mantenci칩n, la agrega al final del array\n  else {\n    // Opcional: a침ade un ID 칰nico si lo necesitas\n    maintenance.id = Date.now()\n    mantencionesVehiculo.push(maintenance)\n  }\n\n  // 游댳 Actualiza el estado del veh칤culo en la tabla principal\n  actualizarEstadoVehiculo(patente)\n  cerrarModal()\n}\n\n// ------------------------------\n// 游댳 Editar una mantenci칩n existente desde el modal de ver\n// ------------------------------\nfunction editarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n\n  // Si no existe lista, se inicializa vac칤a\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n  }\n\n  // Busca el veh칤culo real en la lista principal\n  const vehiculo = mantenciones.value.find(v => v.patente === patente)\n\n  mantencionSeleccionada.value = idx\n  selectedVehiculo.value = vehiculo ? { ...vehiculo } : { patente, odometro: 0 }\n\n  showAddModal.value = true\n}\n\n// ------------------------------\n// 游댳 Determina el estado actual del veh칤culo seg칰n sus mantenciones\n// ------------------------------\nfunction actualizarEstadoVehiculo(patente) {\n  const lista = mantencionesPorPatente[patente]\n\n  // Si no hay mantenciones, el estado es \"OK\"\n  if (!lista || lista.length === 0) {\n    cambiarEstado(patente, 'OK')\n    return\n  }\n\n  // Se prioriza el peor estado presente\n  if (lista.some(m => m.estado === 'Requiere mantenci칩n')) {\n    cambiarEstado(patente, 'Requiere mantenci칩n')\n  } else if (lista.some(m => m.estado === 'Pr칩xima mantenci칩n')) {\n    cambiarEstado(patente, 'Pr칩xima mantenci칩n')\n  } else {\n    cambiarEstado(patente, 'OK')\n  }\n}\n\n// ------------------------------\n// 游댳 Eliminar una mantenci칩n desde el modal de visualizaci칩n\n// ------------------------------\nfunction eliminarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n  mantencionesPorPatente[patente].splice(idx, 1)\n\n  // Al eliminar, recalcula el estado del veh칤culo\n  actualizarEstadoVehiculo(patente)\n}\n\n// ------------------------------\n// 游댳 Cambiar el estado del veh칤culo en la tabla principal\n// ------------------------------\nfunction cambiarEstado(patente, nuevoEstado) {\n  const vehiculo = mantenciones.value.find(v => v.patente === patente)\n  if (vehiculo) {\n    vehiculo.estado = nuevoEstado\n  } else {\n    console.warn(`[Padre] No se encontr칩 veh칤culo con patente ${patente}`)\n  }\n}\n</script>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAK;;uBAAhBC,mBAAA,CAeM,OAfNC,UAeM,GAdJC,YAAA,CACqCC,MAAA;IADjBC,YAAY,EAAED,MAAA,CAAAC,YAAY;IAAGC,iBAAgB,EAAEF,MAAA,CAAAG,eAAe;IAC/EC,mBAAkB,EAAEJ,MAAA,CAAAK;MAEvBN,YAAA,CAEgGC,MAAA;IAFjF,gBAAc,EAAEA,MAAA,CAAAM,YAAY;IAAG,kBAAgB,EAAEN,MAAA,CAAAO,mBAAmB;IAChFN,YAAY,EAAED,MAAA,CAAAQ,sBAAsB,CAACR,MAAA,CAAAO,mBAAmB;IAAU,qBAAmB,EAAEP,MAAA,CAAAS,sBAAsB;IAC7G,WAAS,EAAET,MAAA,CAAAU,gBAAgB,EAAEC,QAAQ;IAAQC,OAAK,EAAEZ,MAAA,CAAAa,WAAW;IAAGC,MAAI,EAAEd,MAAA,CAAAe;uHAG/Cf,MAAA,CAAAgB,YAAY,I,cAAxCC,YAAA,CAG4FjB,MAAA;;IAHjDkB,OAAO,EAAElB,MAAA,CAAAO,mBAAmB;IACpEN,YAAY,EAAED,MAAA,CAAAQ,sBAAsB,CAACR,MAAA,CAAAO,mBAAmB;IACxD,iBAAe,EAAEP,MAAA,CAAAU,gBAAgB,EAAEC,QAAQ;IAAQ,qBAAmB,EAAEX,MAAA,CAAAmB,kBAAkB;IAC1FP,OAAK,EAAAQ,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAErB,MAAA,CAAAgB,YAAY;IAAWM,QAAM,EAAEtB,MAAA,CAAAuB,gBAAgB;IAAGC,UAAQ,EAAExB,MAAA,CAAAyB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}