{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, resolveComponent as _resolveComponent, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-2\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_ModalVerMantenciones = _resolveComponent(\"ModalVerMantenciones\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" Ь Tabla \"), _createVNode($setup[\"MantencionesTable\"], {\n    mantenciones: $setup.mantenciones,\n    onVerMantenciones: $setup.verMantenciones,\n    onAgregarMantencion: $setup.abrirModal\n  }, null, 8 /* PROPS */, [\"mantenciones\"]), _createCommentVNode(\"  Modal multipaso \"), $setup.showAddModal ? (_openBlock(), _createBlock($setup[\"ModalAgregar\"], {\n    key: 0,\n    \"show-add-modal\": $setup.showAddModal,\n    \"selected-patente\": $setup.patenteSeleccionada,\n    mantenciones: $setup.mantenciones,\n    onClose: $setup.cerrarModal,\n    onSave: $setup.guardarMantencion\n  }, null, 8 /* PROPS */, [\"show-add-modal\", \"selected-patente\", \"mantenciones\"])) : _createCommentVNode(\"v-if\", true), _ctx.showVerModal ? (_openBlock(), _createBlock(_component_ModalVerMantenciones, {\n    key: 1,\n    patente: $setup.patenteSeleccionada,\n    mantenciones: $setup.mantencionesPorPatente[$setup.patenteSeleccionada],\n    onClose: _cache[0] || (_cache[0] = $event => _ctx.showVerModal = false),\n    onEditar: _ctx.editarMantencion,\n    onEliminar: _ctx.eliminarMantencion\n  }, null, 8 /* PROPS */, [\"patente\", \"mantenciones\", \"onEditar\", \"onEliminar\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createVNode","$setup","mantenciones","onVerMantenciones","verMantenciones","onAgregarMantencion","abrirModal","showAddModal","_createBlock","patenteSeleccionada","onClose","cerrarModal","onSave","guardarMantencion","_ctx","showVerModal","_component_ModalVerMantenciones","patente","mantencionesPorPatente","_cache","$event","onEditar","editarMantencion","onEliminar","eliminarMantencion"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/MantencionesView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2\">\n    <!-- Ь Tabla -->\n    <MantencionesTable :mantenciones=\"mantenciones\" @ver-mantenciones=\"verMantenciones\"\n      @agregar-mantencion=\"abrirModal\" />\n\n    <!--  Modal multipaso -->\n    <ModalAgregar v-if=\"showAddModal\" :show-add-modal=\"showAddModal\" :selected-patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantenciones\" @close=\"cerrarModal\" @save=\"guardarMantencion\" />\n\n    <ModalVerMantenciones v-if=\"showVerModal\" :patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada]\" @close=\"showVerModal = false\"\n      @editar=\"editarMantencion\" @eliminar=\"eliminarMantencion\" />\n\n\n\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue'\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue'\n\n// Patente seleccionada para el modal\nconst patenteSeleccionada = ref('')\n\nconst mantenciones = ref([\n  { patente: 'ABC123', odometro: 4500, estado: 'OK' },\n  { patente: 'XYZ789', odometro: 72000, estado: 'Requiere mantenci贸n' },\n  { patente: 'DEF456', odometro: 60000, estado: 'Pr贸xima mantenci贸n' },\n])\n\nconst mantencionesPorPatente = ref({\n  // clave = patente, valor = array de mantenciones\n  // ej:\n  // ABC123: [{ name, type, intervalo, alerta, ultimo, umbral, fechaCreacion, estado }, ...]\n})\nfunction guardarMantencion(nuevaMantencion) {\n  const patente = patenteSeleccionada.value\n  if (!mantencionesPorPatente.value[patente]) {\n    mantencionesPorPatente.value[patente] = []\n  }\n\n  // calcular campos autom谩ticos\n  const fechaCreacion = new Date().toISOString()\n  let ultimo = nuevaMantencion.km || nuevaMantencion.fechaUltima\n  let umbral\n  if (nuevaMantencion.type === 'Por Od贸metro') {\n    umbral = parseFloat(ultimo) + parseFloat(nuevaMantencion.intervalo)\n  } else {\n    umbral = new Date(new Date(ultimo).getTime() + nuevaMantencion.intervalo * 24 * 60 * 60 * 1000)\n  }\n\n  const estado = calcularEstado(ultimo, umbral, nuevaMantencion.type)\n\n  // armar objeto final\n  const mantencionGuardada = {\n    ...nuevaMantencion,\n    ultimo,\n    umbral,\n    actual: ultimo, // al inicio es el mismo que ultimo\n    faltante: calcularFaltante(ultimo, umbral, nuevaMantencion.type),\n    fechaCreacion,\n    estado\n  }\n\n  mantencionesPorPatente.value[patente].push(mantencionGuardada)\n}\nfunction calcularFaltante(actual, umbral, type) {\n  if (type === 'Por Od贸metro') return umbral - actual\n  return Math.ceil((new Date(umbral) - new Date(actual)) / (1000 * 60 * 60 * 24))\n}\n\nfunction calcularEstado(actual, umbral, type) {\n  const faltante = calcularFaltante(actual, umbral, type)\n  if (type === 'Por Od贸metro') {\n    if (faltante <= 0) return 'Requiere mantenci贸n'\n    if (faltante <= 1000) return 'Pr贸xima mantenci贸n'\n    return 'OK'\n  } else {\n    if (faltante <= 0) return 'Requiere mantenci贸n'\n    if (faltante <= 5) return 'Pr贸xima mantenci贸n'\n    return 'OK'\n  }\n}\n\n\n// Estado del modal\nconst showAddModal = ref(false)\n// Item seleccionado (para mostrar datos dentro del modal si quieres)\nconst selectedVehiculo = ref(null)\n\nfunction verMantenciones(item) {\n  alert(`Ver mantenciones de ${item.patente}`)\n}\n\nfunction abrirModal(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n  showAddModal.value = true\n}\n\nfunction cerrarModal() {\n  showAddModal.value = false\n  selectedVehiculo.value = null\n}\n</script>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAK;;;uBAAhBC,mBAAA,CAeM,OAfNC,UAeM,GAdJC,mBAAA,cAAiB,EACjBC,YAAA,CACqCC,MAAA;IADjBC,YAAY,EAAED,MAAA,CAAAC,YAAY;IAAGC,iBAAgB,EAAEF,MAAA,CAAAG,eAAe;IAC/EC,mBAAkB,EAAEJ,MAAA,CAAAK;6CAEvBP,mBAAA,wBAA2B,EACPE,MAAA,CAAAM,YAAY,I,cAAhCC,YAAA,CACgFP,MAAA;;IAD7C,gBAAc,EAAEA,MAAA,CAAAM,YAAY;IAAG,kBAAgB,EAAEN,MAAA,CAAAQ,mBAAmB;IACpGP,YAAY,EAAED,MAAA,CAAAC,YAAY;IAAGQ,OAAK,EAAET,MAAA,CAAAU,WAAW;IAAGC,MAAI,EAAEX,MAAA,CAAAY;wHAE/BC,IAAA,CAAAC,YAAY,I,cAAxCP,YAAA,CAE8DQ,+BAAA;;IAFnBC,OAAO,EAAEhB,MAAA,CAAAQ,mBAAmB;IACpEP,YAAY,EAAED,MAAA,CAAAiB,sBAAsB,CAACjB,MAAA,CAAAQ,mBAAmB;IAAIC,OAAK,EAAAS,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEN,IAAA,CAAAC,YAAY;IAC/EM,QAAM,EAAEP,IAAA,CAAAQ,gBAAgB;IAAGC,UAAQ,EAAET,IAAA,CAAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}