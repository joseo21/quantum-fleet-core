{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createBlock as _createBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-2 sm:p-4 w-full flex flex-col\"\n};\nconst _hoisted_2 = {\n  class: \"flex flex-col sm:flex-row justify-between items-center mb-4 gap-3\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" Barra superior y acciones \"), _createElementVNode(\"div\", _hoisted_2, [_createVNode($setup[\"EmpresasTable\"], {\n    customers: $setup.customers,\n    \"search-term\": $setup.searchTerm,\n    \"selected-ids\": $setup.selectedIds,\n    \"rows-per-page\": $setup.rowsPerPage,\n    \"rows-per-page-options\": $setup.rowsPerPageOptions,\n    \"current-page\": $setup.currentPage,\n    \"copied-id\": $setup.copiedId,\n    \"onUpdate:selectedIds\": _cache[0] || (_cache[0] = $event => $setup.selectedIds = $event),\n    onEdit: $setup.editCustomer,\n    onCopy: $setup.copyCustomerData,\n    onToggleSelectAll: $setup.toggleSelectAll,\n    onNextPage: $setup.nextPage,\n    onPreviousPage: $setup.previousPage,\n    onChangeRowsPerPage: _cache[1] || (_cache[1] = $event => $setup.rowsPerPage = $event)\n  }, null, 8 /* PROPS */, [\"customers\", \"search-term\", \"selected-ids\", \"rows-per-page\", \"current-page\", \"copied-id\"])]), _createCommentVNode(\" Sidebar edición \"), $setup.showEditSidebar ? (_openBlock(), _createBlock($setup[\"EditarEmpresasSideBar\"], {\n    key: 0,\n    \"editing-company\": $setup.editingCompany,\n    templates: $setup.templates,\n    onClose: _cache[2] || (_cache[2] = $event => $setup.showEditSidebar = false),\n    onSave: $setup.updateCompany\n  }, null, 8 /* PROPS */, [\"editing-company\", \"templates\"])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Modal agregar empresa \"), $setup.showAddModal ? (_openBlock(), _createBlock($setup[\"AgregarEmpresasModal\"], {\n    key: 1,\n    templates: $setup.templates,\n    \"new-company\": $setup.newCompany,\n    step: $setup.step,\n    \"selected-template\": $setup.selectedTemplate,\n    \"is-step1-valid\": $setup.isStep1Valid,\n    \"modal-button-text\": $setup.modalButtonText,\n    \"is-modal-button-disabled\": $setup.isModalButtonDisabled,\n    onClose: $setup.cancel,\n    onNextStep: $setup.goToNextStep,\n    onAddCompany: $setup.addCompany\n  }, null, 8 /* PROPS */, [\"templates\", \"new-company\", \"step\", \"selected-template\", \"is-step1-valid\", \"modal-button-text\", \"is-modal-button-disabled\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createElementVNode","_hoisted_2","_createVNode","$setup","customers","searchTerm","selectedIds","rowsPerPage","rowsPerPageOptions","currentPage","copiedId","_cache","$event","onEdit","editCustomer","onCopy","copyCustomerData","onToggleSelectAll","toggleSelectAll","onNextPage","nextPage","onPreviousPage","previousPage","onChangeRowsPerPage","showEditSidebar","_createBlock","editingCompany","templates","onClose","onSave","updateCompany","showAddModal","newCompany","step","selectedTemplate","isStep1Valid","modalButtonText","isModalButtonDisabled","cancel","onNextStep","goToNextStep","onAddCompany","addCompany"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/EmpresasView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2 sm:p-4 w-full flex flex-col\">\n    <!-- Barra superior y acciones -->\n    <div class=\"flex flex-col sm:flex-row justify-between items-center mb-4 gap-3\">\n      <EmpresasTable\n        :customers=\"customers\"\n        :search-term=\"searchTerm\"\n        :selected-ids=\"selectedIds\"\n        :rows-per-page=\"rowsPerPage\"\n        :rows-per-page-options=\"rowsPerPageOptions\"\n        :current-page=\"currentPage\"\n        :copied-id=\"copiedId\"\n        @update:selected-ids=\"selectedIds = $event\"\n        @edit=\"editCustomer\"\n        @copy=\"copyCustomerData\"\n        @toggle-select-all=\"toggleSelectAll\"\n        @next-page=\"nextPage\"\n        @previous-page=\"previousPage\"\n        @change-rows-per-page=\"rowsPerPage = $event\"\n      />\n    </div>\n\n    <!-- Sidebar edición -->\n    <EditarEmpresasSideBar\n      v-if=\"showEditSidebar\"\n      :editing-company=\"editingCompany\"\n      :templates=\"templates\"\n      @close=\"showEditSidebar = false\"\n      @save=\"updateCompany\"\n    />\n\n    <!-- Modal agregar empresa -->\n    <AgregarEmpresasModal\n      v-if=\"showAddModal\"\n      :templates=\"templates\"\n      :new-company=\"newCompany\"\n      :step=\"step\"\n      :selected-template=\"selectedTemplate\"\n      :is-step1-valid=\"isStep1Valid\"\n      :modal-button-text=\"modalButtonText\"\n      :is-modal-button-disabled=\"isModalButtonDisabled\"\n      @close=\"cancel\"\n      @next-step=\"goToNextStep\"\n      @add-company=\"addCompany\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, watch } from 'vue'\nimport EmpresasTable from '@/components/EmpresasUi/EmpresasTable.vue'\nimport AgregarEmpresasModal from '@/components/EmpresasUi/AgregarEmpresasModal.vue'\nimport EditarEmpresasSideBar from '@/components/EmpresasUi/EditarEmpresasSideBar.vue'\n\n// Datos y estado (los mismos que tenías)\nconst DEFAULT_TEMPLATE_ID = 1\nconst customers = ref([\n  { id: 1, createdAt: '2025-07-30', name: 'Demo Combustible', rut: '76.145.230-9', contact: 'Marcelo Díaz', city: 'Santiago' },\n  { id: 2, createdAt: '2025-07-23', name: 'Industrial Glover S.P.A.', rut: '77.239.684-2', contact: 'Patricia González', city: 'Lautaro' },\n  { id: 3, createdAt: '2025-05-29', name: 'Cuenta Demo', rut: '76.003.412-5', contact: 'Claudia Muñoz', city: 'Temuco' },\n  // ... demás clientes\n])\n\nconst searchTerm = ref('')\nconst selectedIds = ref([])\nconst selectAll = ref(false)\nconst rowsPerPageOptions = [5, 10, 20, 50]\nconst rowsPerPage = ref(5)\nconst currentPage = ref(1)\nconst showAddModal = ref(false)\nconst step = ref(1)\nconst selectedTemplate = ref(null)\nconst showEditSidebar = ref(false)\nconst editingCompany = ref({ id: null, name: '', rut: '', contact: '', city: '', templateId: DEFAULT_TEMPLATE_ID })\nconst newCompany = ref({ name: '', rut: '', contact: '', city: '' })\nconst copiedId = ref(null)\n\n// Plantillas\nconst templates = ref([\n  { id: 1, name: 'Básico', description: 'Acceso limitado a reportes y panel general.' },\n  { id: 2, name: 'Profesional', description: 'Incluye reportes y comentarios.' },\n  { id: 3, name: 'Avanzado', description: 'Incluye dashboards personalizados y reportes completos.' },\n  { id: 4, name: 'Full', description: 'Todas las funciones habilitadas.' }\n])\n\n// Validación RUT chileno\nconst isValidRut = (rut) => /^(\\d{1,2}\\.\\d{3}\\.\\d{3}-[\\dkK])$/.test(rut)\n\n// Filtrado y paginación\nconst filteredCustomers = computed(() => {\n  if (!searchTerm.value) return customers.value\n  const term = searchTerm.value.toLowerCase()\n  return customers.value.filter(c =>\n    c.name.toLowerCase().includes(term) ||\n    c.rut.toLowerCase().includes(term) ||\n    c.contact.toLowerCase().includes(term) ||\n    c.createdAt.toLowerCase().includes(term)\n  )\n})\n\nconst paginatedCustomers = computed(() => {\n  const start = (currentPage.value - 1) * rowsPerPage.value\n  return filteredCustomers.value.slice(start, start + rowsPerPage.value)\n})\n\nconst totalPages = computed(() => Math.ceil(filteredCustomers.value.length / rowsPerPage.value))\n\nconst toggleSelectAll = () => selectAll.value\n  ? selectedIds.value = paginatedCustomers.value.map(c => c.id)\n  : selectedIds.value = []\n\nconst nextPage = () => { if (currentPage.value < totalPages.value) currentPage.value++ }\nconst previousPage = () => { if (currentPage.value > 1) currentPage.value-- }\n\n// Modal multi-paso\nconst goToNextStep = () => { if (isStep1Valid.value) step.value = 2; else alert('Completa todos los campos correctamente.') }\nconst cancel = () => { showAddModal.value = false; step.value = 1; selectedTemplate.value = null; newCompany.value = { name: '', rut: '', contact: '', city: '' } }\nconst addCompany = () => {\n  if (!selectedTemplate.value) return\n  if (!isValidRut(newCompany.value.rut)) { alert('RUT inválido.'); return }\n  const id = Date.now()\n  const createdAt = new Date().toISOString().slice(0, 10)\n  customers.value.push({ id, createdAt, ...newCompany.value, templateId: selectedTemplate.value })\n  cancel()\n}\n\n// Editar empresa\nconst editCustomer = (customer) => { editingCompany.value = { ...customer }; if (!editingCompany.value.templateId) editingCompany.value.templateId = DEFAULT_TEMPLATE_ID; showEditSidebar.value = true }\nconst updateCompany = () => { const index = customers.value.findIndex(c => c.id === editingCompany.value.id); if (index !== -1) customers.value[index] = { ...editingCompany.value }; showEditSidebar.value = false }\n\n// Copiar datos\nconst copyCustomerData = (customer) => {\n  const data = `Nombre: ${customer.name}\\nRUT: ${customer.rut}\\nContacto: ${customer.contact}`\n  navigator.clipboard.writeText(data).then(() => { copiedId.value = customer.id; setTimeout(() => copiedId.value = null, 1000) })\n}\n\nconst isStep1Valid = computed(() => {\n  const { name, rut, contact, city } = newCompany.value\n  return name.trim() && rut.trim() && contact.trim() && city.trim() && isValidRut(rut)\n})\nconst modalButtonText = computed(() => step.value === 1 ? 'Siguiente' : 'Crear Empresa')\nconst isModalButtonDisabled = computed(() => step.value === 2 && !selectedTemplate.value)\nwatch(paginatedCustomers, () => selectAll.value = false)\n</script>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAiC;;EAErCA,KAAK,EAAC;AAAmE;;uBAFhFC,mBAAA,CA4CM,OA5CNC,UA4CM,GA3CJC,mBAAA,+BAAkC,EAClCC,mBAAA,CAiBM,OAjBNC,UAiBM,GAhBJC,YAAA,CAeEC,MAAA;IAdCC,SAAS,EAAED,MAAA,CAAAC,SAAS;IACpB,aAAW,EAAED,MAAA,CAAAE,UAAU;IACvB,cAAY,EAAEF,MAAA,CAAAG,WAAW;IACzB,eAAa,EAAEH,MAAA,CAAAI,WAAW;IAC1B,uBAAqB,EAAEJ,MAAA,CAAAK,kBAAkB;IACzC,cAAY,EAAEL,MAAA,CAAAM,WAAW;IACzB,WAAS,EAAEN,MAAA,CAAAO,QAAQ;IACnB,sBAAmB,EAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAET,MAAA,CAAAG,WAAW,GAAGM,MAAM;IACzCC,MAAI,EAAEV,MAAA,CAAAW,YAAY;IAClBC,MAAI,EAAEZ,MAAA,CAAAa,gBAAgB;IACtBC,iBAAiB,EAAEd,MAAA,CAAAe,eAAe;IAClCC,UAAS,EAAEhB,MAAA,CAAAiB,QAAQ;IACnBC,cAAa,EAAElB,MAAA,CAAAmB,YAAY;IAC3BC,mBAAoB,EAAAZ,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAET,MAAA,CAAAI,WAAW,GAAGK,MAAM;yHAI/Cb,mBAAA,qBAAwB,EAEhBI,MAAA,CAAAqB,eAAe,I,cADvBC,YAAA,CAMEtB,MAAA;;IAJC,iBAAe,EAAEA,MAAA,CAAAuB,cAAc;IAC/BC,SAAS,EAAExB,MAAA,CAAAwB,SAAS;IACpBC,OAAK,EAAAjB,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAET,MAAA,CAAAqB,eAAe;IACtBK,MAAI,EAAE1B,MAAA,CAAA2B;kGAGT/B,mBAAA,2BAA8B,EAEtBI,MAAA,CAAA4B,YAAY,I,cADpBN,YAAA,CAYEtB,MAAA;;IAVCwB,SAAS,EAAExB,MAAA,CAAAwB,SAAS;IACpB,aAAW,EAAExB,MAAA,CAAA6B,UAAU;IACvBC,IAAI,EAAE9B,MAAA,CAAA8B,IAAI;IACV,mBAAiB,EAAE9B,MAAA,CAAA+B,gBAAgB;IACnC,gBAAc,EAAE/B,MAAA,CAAAgC,YAAY;IAC5B,mBAAiB,EAAEhC,MAAA,CAAAiC,eAAe;IAClC,0BAAwB,EAAEjC,MAAA,CAAAkC,qBAAqB;IAC/CT,OAAK,EAAEzB,MAAA,CAAAmC,MAAM;IACbC,UAAS,EAAEpC,MAAA,CAAAqC,YAAY;IACvBC,YAAW,EAAEtC,MAAA,CAAAuC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}