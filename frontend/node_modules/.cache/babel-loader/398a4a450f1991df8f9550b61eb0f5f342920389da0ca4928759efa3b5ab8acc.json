{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-2\"\n};\nexport function render(_ctx, _cache) {\n  const _component_MantencionesTable = _resolveComponent(\"MantencionesTable\");\n  const _component_ModalAgregar = _resolveComponent(\"ModalAgregar\");\n  const _component_ModalVerMantenciones = _resolveComponent(\"ModalVerMantenciones\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_MantencionesTable, {\n    mantenciones: _ctx.mantenciones,\n    onVerMantenciones: _ctx.verMantenciones,\n    onAgregarMantencion: _ctx.abrirModal\n  }, null, 8 /* PROPS */, [\"mantenciones\", \"onVerMantenciones\", \"onAgregarMantencion\"]), _createVNode(_component_ModalAgregar, {\n    \"show-add-modal\": _ctx.showAddModal,\n    \"selected-patente\": _ctx.patenteSeleccionada,\n    mantenciones: _ctx.mantencionesPorPatente[_ctx.patenteSeleccionada] || [],\n    \"selected-mantencion\": _ctx.mantencionSeleccionada,\n    \"km-actual\": _ctx.selectedVehiculo?.odometro || 0,\n    onClose: _ctx.cerrarModal,\n    onSave: _ctx.guardarMantencion\n  }, null, 8 /* PROPS */, [\"show-add-modal\", \"selected-patente\", \"mantenciones\", \"selected-mantencion\", \"km-actual\", \"onClose\", \"onSave\"]), _ctx.showVerModal ? (_openBlock(), _createBlock(_component_ModalVerMantenciones, {\n    key: 0,\n    patente: _ctx.patenteSeleccionada,\n    mantenciones: _ctx.mantencionesPorPatente[_ctx.patenteSeleccionada] || [],\n    \"odometro-actual\": _ctx.selectedVehiculo?.odometro || 0,\n    \"horometros-actuales\": _ctx.horometrosActuales,\n    onClose: _cache[0] || (_cache[0] = $event => _ctx.showVerModal = false),\n    onEditar: _ctx.editarMantencion,\n    onEliminar: _ctx.eliminarMantencion\n  }, null, 8 /* PROPS */, [\"patente\", \"mantenciones\", \"odometro-actual\", \"horometros-actuales\", \"onEditar\", \"onEliminar\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_MantencionesTable","mantenciones","_ctx","onVerMantenciones","verMantenciones","onAgregarMantencion","abrirModal","_component_ModalAgregar","showAddModal","patenteSeleccionada","mantencionesPorPatente","mantencionSeleccionada","selectedVehiculo","odometro","onClose","cerrarModal","onSave","guardarMantencion","showVerModal","_createBlock","_component_ModalVerMantenciones","patente","horometrosActuales","_cache","$event","onEditar","editarMantencion","onEliminar","eliminarMantencion"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/MantencionesView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2\">\n    <MantencionesTable :mantenciones=\"mantenciones\" @ver-mantenciones=\"verMantenciones\"\n      @agregar-mantencion=\"abrirModal\" />\n\n    <ModalAgregar :show-add-modal=\"showAddModal\" :selected-patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\" :selected-mantencion=\"mantencionSeleccionada\"\n      :km-actual=\"selectedVehiculo?.odometro || 0\" @close=\"cerrarModal\" @save=\"guardarMantencion\" />\n\n\n    <ModalVerMantenciones v-if=\"showVerModal\" :patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\"\n      :odometro-actual=\"selectedVehiculo?.odometro || 0\" :horometros-actuales=\"horometrosActuales\"\n      @close=\"showVerModal = false\" @editar=\"editarMantencion\" @eliminar=\"eliminarMantencion\" />\n\n\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue'\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue'\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue'\nimport ModalVerMantenciones from '@/components/MantencionesUi/ModalVerMantenciones.vue'\n\n// ------------------------------\n//  Variables reactivas principales\n// ------------------------------\nconst patenteSeleccionada = ref('')              // Guarda la patente del veh铆culo actualmente seleccionado\nconst selectedVehiculo = ref(null)               // Guarda los datos del veh铆culo al que se le est谩 agregando/editar una mantenci贸n\nconst mantencionSeleccionada = ref(null)         // ndice de la mantenci贸n que se est谩 editando\n\nconst showAddModal = ref(false)                  // Controla la visibilidad del modal de agregar/editar\nconst showVerModal = ref(false)                  // Controla la visibilidad del modal de ver mantenciones\n\n//  Diccionario reactivo que guarda las mantenciones por veh铆culo (clave = patente)\nconst mantencionesPorPatente = reactive({})\n\n// ------------------------------\n//  Lista principal de veh铆culos\n// ------------------------------\nconst mantenciones  =([\n  { patente: 'GHI901 - N掳1', odometro: 12500, estado: 'OK' },\n  { patente: 'JKL234 - N掳2', odometro: 98500, estado: 'Requiere mantenci贸n' },\n  { patente: 'MNO567 - N掳3', odometro: 35000, estado: 'Pr贸xima mantenci贸n' },\n  { patente: 'PQR890 - N掳4', odometro: 21000, estado: 'OK' },\n  { patente: 'STU12A - N掳5', odometro: 110000, estado: 'Requiere mantenci贸n' },\n  { patente: 'VWX34B - N掳6', odometro: 48000, estado: 'Pr贸xima mantenci贸n' },\n  { patente: 'YZA67C - N掳7', odometro: 6000, estado: 'OK' },\n  { patente: 'BCD90D - N掳8', odometro: 155000, estado: 'Requiere mantenci贸n' },\n  { patente: 'EFG23E - N掳9', odometro: 75500, estado: 'Pr贸xima mantenci贸n' },\n  { patente: 'HIJ56F - N掳10', odometro: 1900, estado: 'OK' },\n];\nconst horometrosActuales = {\n  'ABC123': 145,   // veh铆culo 1\n  'XYZ789': 230,  // veh铆culo 2\n  'DEF456': 87,   // veh铆culo 3\n}\n// ------------------------------\n//  Abrir modal para agregar o editar mantenci贸n\n// ------------------------------\nfunction abrirModal(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n\n  // Si no existe una lista de mantenciones para esa patente, se crea\n  if (!mantencionesPorPatente[item.patente]) {\n    mantencionesPorPatente[item.patente] = []\n  }\n\n  mantencionSeleccionada.value = null\n  showAddModal.value = true\n}\n\n// ------------------------------\n//  Cerrar modal de agregar/editar\n// ------------------------------\nfunction cerrarModal() {\n  showAddModal.value = false\n  selectedVehiculo.value = null\n  mantencionSeleccionada.value = null\n}\n\n// ------------------------------\n//  Abrir modal de visualizaci贸n de mantenciones\n// ------------------------------\nfunction verMantenciones(item) {\n  patenteSeleccionada.value = item.patente\n  showVerModal.value = true\n}\n\n// ------------------------------\n//  Guardar mantenci贸n (nuevo registro o edici贸n existente)\n// ------------------------------\nfunction guardarMantencion(maintenance) {\n  const patente = patenteSeleccionada.value\n\n  // Si no existe una lista para esa patente, se crea reactivamente\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n  }\n\n  const mantencionesVehiculo = mantencionesPorPatente[patente]\n  const editingIndex = mantencionSeleccionada.value\n\n  // Si se est谩 editando, reemplaza el registro\n  if (editingIndex !== null) {\n    mantencionesVehiculo[editingIndex] = maintenance\n  }\n  // Si es una nueva mantenci贸n, la agrega al final del array\n  else {\n    mantencionesVehiculo.push(maintenance)\n  }\n\n  //  Actualiza el estado del veh铆culo en la tabla principal seg煤n sus mantenciones\n  actualizarEstadoVehiculo(patente)\n  cerrarModal()\n}\n\n// ------------------------------\n//  Editar una mantenci贸n existente desde el modal de ver\n// ------------------------------\nfunction editarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n\n  // Si no existe lista, se inicializa vac铆a\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n  }\n\n  // Busca el veh铆culo real en la lista principal\n  const vehiculo = mantenciones.value.find(v => v.patente === patente)\n\n  mantencionSeleccionada.value = idx\n  selectedVehiculo.value = vehiculo ? { ...vehiculo } : { patente, odometro: 0 }\n\n  showAddModal.value = true\n}\n\n// ------------------------------\n//  Determina el estado actual del veh铆culo seg煤n sus mantenciones\n// ------------------------------\nfunction actualizarEstadoVehiculo(patente) {\n  const lista = mantencionesPorPatente[patente]\n\n  // Si no hay mantenciones, el estado es \"OK\"\n  if (!lista || lista.length === 0) {\n    cambiarEstado(patente, 'OK')\n    return\n  }\n\n  // Se prioriza el peor estado presente\n  if (lista.some(m => m.estado === 'Requiere mantenci贸n')) {\n    cambiarEstado(patente, 'Requiere mantenci贸n')\n  } else if (lista.some(m => m.estado === 'Pr贸xima mantenci贸n')) {\n    cambiarEstado(patente, 'Pr贸xima mantenci贸n')\n  } else {\n    cambiarEstado(patente, 'OK')\n  }\n}\n\n// ------------------------------\n//  Eliminar una mantenci贸n desde el modal de visualizaci贸n\n// ------------------------------\nfunction eliminarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n  mantencionesPorPatente[patente].splice(idx, 1)\n\n  // Al eliminar, recalcula el estado del veh铆culo\n  actualizarEstadoVehiculo(patente)\n}\n\n// ------------------------------\n//  Cambiar el estado del veh铆culo en la tabla principal\n// ------------------------------\nfunction cambiarEstado(patente, nuevoEstado) {\n  const vehiculo = mantenciones.value.find(v => v.patente === patente)\n  if (vehiculo) {\n    vehiculo.estado = nuevoEstado\n  } else {\n    console.warn(`[Padre] No se encontr贸 veh铆culo con patente ${patente}`)\n  }\n}\n</script>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAK;;;;;uBAAhBC,mBAAA,CAeM,OAfNC,UAeM,GAdJC,YAAA,CACqCC,4BAAA;IADjBC,YAAY,EAAEC,IAAA,CAAAD,YAAY;IAAGE,iBAAgB,EAAED,IAAA,CAAAE,eAAe;IAC/EC,mBAAkB,EAAEH,IAAA,CAAAI;yFAEvBP,YAAA,CAEgGQ,uBAAA;IAFjF,gBAAc,EAAEL,IAAA,CAAAM,YAAY;IAAG,kBAAgB,EAAEN,IAAA,CAAAO,mBAAmB;IAChFR,YAAY,EAAEC,IAAA,CAAAQ,sBAAsB,CAACR,IAAA,CAAAO,mBAAmB;IAAU,qBAAmB,EAAEP,IAAA,CAAAS,sBAAsB;IAC7G,WAAS,EAAET,IAAA,CAAAU,gBAAgB,EAAEC,QAAQ;IAAQC,OAAK,EAAEZ,IAAA,CAAAa,WAAW;IAAGC,MAAI,EAAEd,IAAA,CAAAe;4IAG/Cf,IAAA,CAAAgB,YAAY,I,cAAxCC,YAAA,CAG4FC,+BAAA;;IAHjDC,OAAO,EAAEnB,IAAA,CAAAO,mBAAmB;IACpER,YAAY,EAAEC,IAAA,CAAAQ,sBAAsB,CAACR,IAAA,CAAAO,mBAAmB;IACxD,iBAAe,EAAEP,IAAA,CAAAU,gBAAgB,EAAEC,QAAQ;IAAQ,qBAAmB,EAAEX,IAAA,CAAAoB,kBAAkB;IAC1FR,OAAK,EAAAS,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEtB,IAAA,CAAAgB,YAAY;IAAWO,QAAM,EAAEvB,IAAA,CAAAwB,gBAAgB;IAAGC,UAAQ,EAAEzB,IAAA,CAAA0B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}