{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue';\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue';\n\n// Patente seleccionada para el modal\n\nexport default {\n  __name: 'MantencionesView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const patenteSeleccionada = ref('');\n    const mantenciones = ref([{\n      patente: 'ABC123',\n      odometro: 4500,\n      estado: 'OK'\n    }, {\n      patente: 'XYZ789',\n      odometro: 72000,\n      estado: 'Requiere mantenci贸n'\n    }, {\n      patente: 'DEF456',\n      odometro: 60000,\n      estado: 'Pr贸xima mantenci贸n'\n    }]);\n    const mantencionesPorPatente = ref({\n      // clave = patente, valor = array de mantenciones\n      // ej:\n      // ABC123: [{ name, type, intervalo, alerta, ultimo, umbral, fechaCreacion, estado }, ...]\n    });\n    function guardarMantencion(nuevaMantencion) {\n      const patente = patenteSeleccionada.value;\n      if (!mantencionesPorPatente.value[patente]) {\n        mantencionesPorPatente.value[patente] = [];\n      }\n\n      // calcular campos autom谩ticos\n      const fechaCreacion = new Date().toISOString();\n      let ultimo = nuevaMantencion.km || nuevaMantencion.fechaUltima;\n      let umbral;\n      if (nuevaMantencion.type === 'Por Od贸metro') {\n        umbral = parseFloat(ultimo) + parseFloat(nuevaMantencion.intervalo);\n      } else {\n        umbral = new Date(new Date(ultimo).getTime() + nuevaMantencion.intervalo * 24 * 60 * 60 * 1000);\n      }\n      const estado = calcularEstado(ultimo, umbral, nuevaMantencion.type);\n\n      // armar objeto final\n      const mantencionGuardada = {\n        ...nuevaMantencion,\n        ultimo,\n        umbral,\n        actual: ultimo,\n        // al inicio es el mismo que ultimo\n        faltante: calcularFaltante(ultimo, umbral, nuevaMantencion.type),\n        fechaCreacion,\n        estado\n      };\n      mantencionesPorPatente.value[patente].push(mantencionGuardada);\n    }\n    function calcularFaltante(actual, umbral, type) {\n      if (type === 'Por Od贸metro') return umbral - actual;\n      return Math.ceil((new Date(umbral) - new Date(actual)) / (1000 * 60 * 60 * 24));\n    }\n    function calcularEstado(actual, umbral, type) {\n      const faltante = calcularFaltante(actual, umbral, type);\n      if (type === 'Por Od贸metro') {\n        if (faltante <= 0) return 'Requiere mantenci贸n';\n        if (faltante <= 1000) return 'Pr贸xima mantenci贸n';\n        return 'OK';\n      } else {\n        if (faltante <= 0) return 'Requiere mantenci贸n';\n        if (faltante <= 5) return 'Pr贸xima mantenci贸n';\n        return 'OK';\n      }\n    }\n\n    // Estado del modal\n    const showAddModal = ref(false);\n    // Item seleccionado (para mostrar datos dentro del modal si quieres)\n    const selectedVehiculo = ref(null);\n    function verMantenciones(item) {\n      alert(`Ver mantenciones de ${item.patente}`);\n    }\n    function abrirModal(item) {\n      selectedVehiculo.value = item;\n      patenteSeleccionada.value = item.patente;\n      showAddModal.value = true;\n    }\n    function cerrarModal() {\n      showAddModal.value = false;\n      selectedVehiculo.value = null;\n    }\n    const __returned__ = {\n      patenteSeleccionada,\n      mantenciones,\n      mantencionesPorPatente,\n      guardarMantencion,\n      calcularFaltante,\n      calcularEstado,\n      showAddModal,\n      selectedVehiculo,\n      verMantenciones,\n      abrirModal,\n      cerrarModal,\n      ref,\n      MantencionesTable,\n      ModalAgregar\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","MantencionesTable","ModalAgregar","patenteSeleccionada","mantenciones","patente","odometro","estado","mantencionesPorPatente","guardarMantencion","nuevaMantencion","value","fechaCreacion","Date","toISOString","ultimo","km","fechaUltima","umbral","type","parseFloat","intervalo","getTime","calcularEstado","mantencionGuardada","actual","faltante","calcularFaltante","push","Math","ceil","showAddModal","selectedVehiculo","verMantenciones","item","alert","abrirModal","cerrarModal"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/MantencionesView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2\">\n    <!-- Ь Tabla -->\n    <MantencionesTable :mantenciones=\"mantenciones\" @ver-mantenciones=\"verMantenciones\"\n      @agregar-mantencion=\"abrirModal\" />\n\n    <!--  Modal multipaso -->\n    <ModalAgregar v-if=\"showAddModal\" :show-add-modal=\"showAddModal\" :selected-patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantenciones\" @close=\"cerrarModal\" @save=\"guardarMantencion\" />\n\n    <ModalVerMantenciones v-if=\"showViewModal\" :show-view-modal=\"showViewModal\" :selected-patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantenciones\" :vehiculos=\"mantencionesVehiculos\" @close=\"cerrarModal\" @editar=\"editarMantencion\"\n      @eliminar=\"eliminarMantencion\" />\n\n\n\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue'\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue'\n\n// Patente seleccionada para el modal\nconst patenteSeleccionada = ref('')\n\nconst mantenciones = ref([\n  { patente: 'ABC123', odometro: 4500, estado: 'OK' },\n  { patente: 'XYZ789', odometro: 72000, estado: 'Requiere mantenci贸n' },\n  { patente: 'DEF456', odometro: 60000, estado: 'Pr贸xima mantenci贸n' },\n])\n\nconst mantencionesPorPatente = ref({\n  // clave = patente, valor = array de mantenciones\n  // ej:\n  // ABC123: [{ name, type, intervalo, alerta, ultimo, umbral, fechaCreacion, estado }, ...]\n})\nfunction guardarMantencion(nuevaMantencion) {\n  const patente = patenteSeleccionada.value\n  if (!mantencionesPorPatente.value[patente]) {\n    mantencionesPorPatente.value[patente] = []\n  }\n\n  // calcular campos autom谩ticos\n  const fechaCreacion = new Date().toISOString()\n  let ultimo = nuevaMantencion.km || nuevaMantencion.fechaUltima\n  let umbral\n  if (nuevaMantencion.type === 'Por Od贸metro') {\n    umbral = parseFloat(ultimo) + parseFloat(nuevaMantencion.intervalo)\n  } else {\n    umbral = new Date(new Date(ultimo).getTime() + nuevaMantencion.intervalo*24*60*60*1000)\n  }\n\n  const estado = calcularEstado(ultimo, umbral, nuevaMantencion.type)\n\n  // armar objeto final\n  const mantencionGuardada = {\n    ...nuevaMantencion,\n    ultimo,\n    umbral,\n    actual: ultimo, // al inicio es el mismo que ultimo\n    faltante: calcularFaltante(ultimo, umbral, nuevaMantencion.type),\n    fechaCreacion,\n    estado\n  }\n\n  mantencionesPorPatente.value[patente].push(mantencionGuardada)\n}\nfunction calcularFaltante(actual, umbral, type) {\n  if (type === 'Por Od贸metro') return umbral - actual\n  return Math.ceil((new Date(umbral) - new Date(actual))/(1000*60*60*24))\n}\n\nfunction calcularEstado(actual, umbral, type) {\n  const faltante = calcularFaltante(actual, umbral, type)\n  if (type === 'Por Od贸metro') {\n    if (faltante <= 0) return 'Requiere mantenci贸n'\n    if (faltante <= 1000) return 'Pr贸xima mantenci贸n'\n    return 'OK'\n  } else {\n    if (faltante <= 0) return 'Requiere mantenci贸n'\n    if (faltante <= 5) return 'Pr贸xima mantenci贸n'\n    return 'OK'\n  }\n}\n\n\n// Estado del modal\nconst showAddModal = ref(false)\n// Item seleccionado (para mostrar datos dentro del modal si quieres)\nconst selectedVehiculo = ref(null)\n\nfunction verMantenciones(item) {\n  alert(`Ver mantenciones de ${item.patente}`)\n}\n\nfunction abrirModal(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n  showAddModal.value = true\n}\n\nfunction cerrarModal() {\n  showAddModal.value = false\n  selectedVehiculo.value = null\n}\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}