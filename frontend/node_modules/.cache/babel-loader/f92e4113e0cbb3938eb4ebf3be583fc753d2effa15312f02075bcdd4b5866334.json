{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-2\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" üßæ Tabla \"), _createVNode($setup[\"MantencionesTable\"], {\n    mantenciones: $setup.mantenciones,\n    onVerMantenciones: $setup.verMantenciones,\n    onAgregarMantencion: $setup.abrirModal\n  }, null, 8 /* PROPS */, [\"mantenciones\"]), _createCommentVNode(\" ü™ü Modal Agregar \"), $setup.showAddModal ? (_openBlock(), _createBlock($setup[\"ModalAgregar\"], {\n    key: 0,\n    \"show-add-modal\": $setup.showAddModal,\n    \"selected-patente\": $setup.patenteSeleccionada,\n    onClose: $setup.cerrarModal,\n    onSave: $setup.guardarMantencion\n  }, null, 8 /* PROPS */, [\"show-add-modal\", \"selected-patente\"])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" üëÅÔ∏è Modal Ver \"), $setup.showViewModal ? (_openBlock(), _createBlock($setup[\"ModalVerMantenciones\"], {\n    key: 1,\n    mantenciones: $setup.mantencionesVehiculoSeleccionado,\n    patente: $setup.patenteSeleccionada,\n    onClose: $setup.cerrarVerModal\n  }, null, 8 /* PROPS */, [\"mantenciones\", \"patente\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createVNode","$setup","mantenciones","onVerMantenciones","verMantenciones","onAgregarMantencion","abrirModal","showAddModal","_createBlock","patenteSeleccionada","onClose","cerrarModal","onSave","guardarMantencion","showViewModal","mantencionesVehiculoSeleccionado","patente","cerrarVerModal"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/MantencionesView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2\">\n    <!-- üßæ Tabla -->\n    <MantencionesTable \n      :mantenciones=\"mantenciones\" \n      @ver-mantenciones=\"verMantenciones\"\n      @agregar-mantencion=\"abrirModal\" \n    />\n\n    <!-- ü™ü Modal Agregar -->\n    <ModalAgregar \n      v-if=\"showAddModal\" \n      :show-add-modal=\"showAddModal\"\n      :selected-patente=\"patenteSeleccionada\"\n      @close=\"cerrarModal\"\n      @save=\"guardarMantencion\" \n    />\n\n    <!-- üëÅÔ∏è Modal Ver -->\n    <ModalVerMantenciones\n      v-if=\"showViewModal\"\n      :mantenciones=\"mantencionesVehiculoSeleccionado\"\n      :patente=\"patenteSeleccionada\"\n      @close=\"cerrarVerModal\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue'\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue'\nimport ModalVerMantenciones from '@/components/MantencionesUi/ModalVerMantenciones.vue'\n\n// Lista general de veh√≠culos\nconst mantenciones = ref([\n  { patente: 'ABC123', odometro: 4500, estado: 'OK', registros: [] },\n  { patente: 'XYZ789', odometro: 72000, estado: 'Requiere mantenci√≥n', registros: [] },\n  { patente: 'DEF456', odometro: 60000, estado: 'Pr√≥xima mantenci√≥n', registros: [] },\n])\n\nconst patenteSeleccionada = ref('')\nconst selectedVehiculo = ref(null)\nconst showAddModal = ref(false)\nconst showViewModal = ref(false)\n\n// üîπ Abrir modal para agregar\nfunction abrirModal(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n  showAddModal.value = true\n}\n\n// üîπ Guardar mantenci√≥n agregada\nfunction guardarMantencion(data) {\n  const vehiculo = mantenciones.value.find(v => v.patente === patenteSeleccionada.value)\n  if (!vehiculo) return\n\n  const ahora = new Date()\n  const fechaCreacion = ahora.toLocaleString('es-CL')\n\n  // Calcular umbral y faltante\n  let umbral, faltante\n  if (data.type === 'Por Od√≥metro') {\n    umbral = Number(data.km) + Number(data.intervalo)\n    faltante = umbral - vehiculo.odometro\n  } else {\n    const ultima = new Date(data.fechaUltima)\n    const intervaloDias = Number(data.intervalo)\n    const fechaUmbral = new Date(ultima)\n    fechaUmbral.setDate(ultima.getDate() + intervaloDias)\n    umbral = fechaUmbral.toLocaleDateString('es-CL')\n    const diffMs = fechaUmbral - ahora\n    faltante = Math.ceil(diffMs / (1000 * 60 * 60 * 24))\n  }\n\n  const nuevo = {\n    nombre: data.name,\n    tipo: data.type,\n    intervalo: data.intervalo,\n    ultimo: data.type === 'Por Od√≥metro' ? data.km : data.fechaUltima,\n    umbral,\n    actual: data.type === 'Por Od√≥metro' ? vehiculo.odometro : new Date().toLocaleDateString('es-CL'),\n    faltante,\n    fechaCreacion,\n    estado: definirEstado(faltante, data.type),\n  }\n\n  vehiculo.registros.push(nuevo)\n  showAddModal.value = false\n}\n\n// üîπ Estado seg√∫n distancia o d√≠as faltantes\nfunction definirEstado(faltante, tipo) {\n  if (tipo === 'Por Od√≥metro') {\n    if (faltante <= 0) return 'Requiere mantenci√≥n'\n    if (faltante <= 500) return 'Pr√≥xima mantenci√≥n'\n    return 'OK'\n  } else {\n    if (faltante <= 0) return 'Requiere mantenci√≥n'\n    if (faltante <= 7) return 'Pr√≥xima mantenci√≥n'\n    return 'OK'\n  }\n}\n\n// üîπ Abrir modal de ver\nfunction verMantenciones(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n  showViewModal.value = true\n}\n\nfunction cerrarModal() {\n  showAddModal.value = false\n}\n\nfunction cerrarVerModal() {\n  showViewModal.value = false\n}\n\n// üîπ Mantenciones espec√≠ficas del veh√≠culo\nconst mantencionesVehiculoSeleccionado = computed(() => {\n  return selectedVehiculo.value?.registros || []\n})\n</script>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAK;;uBAAhBC,mBAAA,CAwBM,OAxBNC,UAwBM,GAvBJC,mBAAA,cAAiB,EACjBC,YAAA,CAIEC,MAAA;IAHCC,YAAY,EAAED,MAAA,CAAAC,YAAY;IAC1BC,iBAAgB,EAAEF,MAAA,CAAAG,eAAe;IACjCC,mBAAkB,EAAEJ,MAAA,CAAAK;6CAGvBP,mBAAA,sBAAyB,EAEjBE,MAAA,CAAAM,YAAY,I,cADpBC,YAAA,CAMEP,MAAA;;IAJC,gBAAc,EAAEA,MAAA,CAAAM,YAAY;IAC5B,kBAAgB,EAAEN,MAAA,CAAAQ,mBAAmB;IACrCC,OAAK,EAAET,MAAA,CAAAU,WAAW;IAClBC,MAAI,EAAEX,MAAA,CAAAY;wGAGTd,mBAAA,mBAAsB,EAEdE,MAAA,CAAAa,aAAa,I,cADrBN,YAAA,CAKEP,MAAA;;IAHCC,YAAY,EAAED,MAAA,CAAAc,gCAAgC;IAC9CC,OAAO,EAAEf,MAAA,CAAAQ,mBAAmB;IAC5BC,OAAK,EAAET,MAAA,CAAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}