{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { ref, computed, watch } from 'vue';\nimport SvgIcon from '@/components/icons/SvgIcon.vue';\nexport default {\n  __name: 'AgregarEmpresasModal',\n  props: {\n    showAddModal: {\n      type: Boolean,\n      required: true\n    },\n    templates: {\n      type: Array,\n      required: true\n    }\n  },\n  emits: ['close', 'add-company'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n\n    // Estado interno del modal\n    const step = ref(1);\n    const selectedTemplate = ref(null);\n    const newCompany = ref({\n      name: '',\n      rut: '',\n      contact: '',\n      city: ''\n    });\n\n    // Lógica de validación de RUT (necesaria para el paso 1)\n    const isValidRut = rut => /^(\\d{1,2}\\.\\d{3}\\.\\d{3}-[\\dkK])$/.test(rut);\n\n    // Formateo automático RUT mientras se escribe\n    const formatRut = () => {\n      let rut = newCompany.value.rut.replace(/[^0-9kK]/g, '');\n      if (rut.length > 9) rut = rut.slice(0, 9);\n      if (rut.length > 1) {\n        const body = rut.slice(0, -1);\n        const dv = rut.slice(-1);\n        const reversed = body.split('').reverse();\n        const withDots = [];\n        reversed.forEach((char, i) => {\n          if (i > 0 && i % 3 === 0) withDots.push('.');\n          withDots.push(char);\n        });\n        newCompany.value.rut = withDots.reverse().join('') + '-' + dv;\n      } else {\n        newCompany.value.rut = rut;\n      }\n    };\n\n    // Validación paso 1: todos los campos requeridos + RUT válido\n    const isStep1Valid = computed(() => {\n      const {\n        name,\n        rut,\n        contact,\n        city\n      } = newCompany.value;\n      return name.trim() && rut.trim() && contact.trim() && city.trim() && isValidRut(rut);\n    });\n\n    // Navegación\n    const goToNextStep = () => {\n      if (isStep1Valid.value) step.value = 2;else alert('Completa todos los campos correctamente antes de continuar.');\n    };\n\n    // Envío de la nueva empresa\n    const submitAddCompany = () => {\n      if (!selectedTemplate.value) return; // Doble chequeo, aunque el botón debería estar deshabilitado\n\n      // Enviamos los datos al padre para que él se encargue de la lógica de guardado y manejo de array\n      emit('add-company', {\n        ...newCompany.value,\n        templateId: selectedTemplate.value\n      });\n\n      // Resetear el estado del modal (simula el 'cancel' del padre)\n      step.value = 1;\n      selectedTemplate.value = null;\n      newCompany.value = {\n        name: '',\n        rut: '',\n        contact: '',\n        city: ''\n      };\n    };\n\n    // Computed para texto dinámico de botones en modal\n    const modalButtonText = computed(() => step.value === 1 ? 'Siguiente' : 'Crear Empresa');\n    const isModalButtonDisabled = computed(() => step.value === 2 && !selectedTemplate.value);\n\n    // Watcher para resetear el estado del modal cuando se oculta\n    watch(() => props.showAddModal, newValue => {\n      if (!newValue) {\n        // Resetear el estado al cerrar\n        step.value = 1;\n        selectedTemplate.value = null;\n        newCompany.value = {\n          name: '',\n          rut: '',\n          contact: '',\n          city: ''\n        };\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      step,\n      selectedTemplate,\n      newCompany,\n      isValidRut,\n      formatRut,\n      isStep1Valid,\n      goToNextStep,\n      submitAddCompany,\n      modalButtonText,\n      isModalButtonDisabled,\n      ref,\n      computed,\n      watch,\n      SvgIcon\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","watch","SvgIcon","props","__props","emit","__emit","step","selectedTemplate","newCompany","name","rut","contact","city","isValidRut","test","formatRut","value","replace","length","slice","body","dv","reversed","split","reverse","withDots","forEach","char","i","push","join","isStep1Valid","trim","goToNextStep","alert","submitAddCompany","templateId","modalButtonText","isModalButtonDisabled","showAddModal","newValue"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/components/EmpresasUi/AgregarEmpresasModal.vue"],"sourcesContent":["<template>\n  <div v-if=\"showAddModal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n    <div\n      class=\"bg-white dark:bg-gray-900 text-gray-900 dark:text-white rounded-lg relative flex flex-col w-full max-w-lg h-auto p-6 border border-gray-300 dark:border-gray-700 shadow-xl\">\n\n      <button v-if=\"step === 2\" @click=\"step = 1\"\n        class=\"absolute top-4 left-4 p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition\" title=\"Volver\">\n        <SvgIcon name=\"arrow-left\" class=\"w-6 h-6\" />\n      </button>\n\n      <h2 class=\"text-2xl font-bold mb-4 text-center text-[#102372] dark:text-[#ff6600]\">\n        {{ step === 1 ? 'Agregar Empresa' : 'Seleccionar Template' }}\n      </h2>\n\n      <span class=\"h-px bg-gray-300 dark:bg-gray-700 mb-4\"></span>\n\n      <form v-if=\"step === 1\" @submit.prevent=\"goToNextStep\" class=\"flex-1 flex flex-col gap-3 py-2 overflow-y-auto\">\n        <input v-model=\"newCompany.name\" type=\"text\" placeholder=\"Nombre de la empresa\"\n          class=\"px-3 py-2 rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none\"\n          required />\n\n        <input v-model=\"newCompany.rut\" type=\"text\" placeholder=\"RUT de la empresa\"\n          class=\"px-3 py-2 rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none\"\n          required @input=\"formatRut\" />\n\n        <input v-model=\"newCompany.contact\" type=\"text\" placeholder=\"Contacto\"\n          class=\"px-3 py-2 rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none\"\n          required />\n\n        <input v-model=\"newCompany.city\" type=\"text\" placeholder=\"Ciudad de la empresa\"\n          class=\"px-3 py-2 rounded border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none\"\n          required />\n      </form>\n\n      <div v-else class=\"grid grid-cols-1 sm:grid-cols-2 gap-4 py-4\">\n        <div v-for=\"template in templates\" :key=\"template.id\" @click=\"selectedTemplate = template.id\" :class=\"[\n          'p-6 rounded-lg border cursor-pointer text-center transition',\n          selectedTemplate === template.id\n            ? 'border-[#ff6600] bg-orange-100 dark:bg-[#e65500]/30'\n            : 'border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800'\n        ]\">\n          <h3 class=\"text-lg font-semibold mb-2\">{{ template.name }}</h3>\n          <p class=\"text-gray-500 dark:text-gray-400 text-sm\">{{ template.description }}</p>\n        </div>\n      </div>\n\n      <div class=\"flex justify-between mt-6\">\n        <button @click=\"$emit('close')\" class=\"bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded w-[48%] text-white\">\n          Cancelar\n        </button>\n\n        <button v-if=\"step === 1\" @click=\"goToNextStep\" :disabled=\"!isStep1Valid\"\n          :class=\"['px-4 py-2 rounded w-[48%] text-white font-medium', isStep1Valid ? 'bg-[#102372] hover:bg-[#0c1a5b]' : 'bg-[#102372]/50 cursor-not-allowed']\">\n          {{ modalButtonText }}\n        </button>\n\n        <button v-else @click=\"submitAddCompany\" :disabled=\"isModalButtonDisabled\"\n          :class=\"['px-4 py-2 rounded w-[48%] text-white font-medium', isModalButtonDisabled ? 'bg-[#ff6600]/50 cursor-not-allowed' : 'bg-[#ff6600] hover:bg-[#e65500]']\">\n          {{ modalButtonText }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, watch } from 'vue'\nimport SvgIcon from '@/components/icons/SvgIcon.vue'\n\nconst props = defineProps({\n  showAddModal: { type: Boolean, required: true },\n  templates: { type: Array, required: true }\n})\n\nconst emit = defineEmits(['close', 'add-company'])\n\n// Estado interno del modal\nconst step = ref(1)\nconst selectedTemplate = ref(null)\nconst newCompany = ref({ name: '', rut: '', contact: '', city: '' })\n\n// Lógica de validación de RUT (necesaria para el paso 1)\nconst isValidRut = (rut) => /^(\\d{1,2}\\.\\d{3}\\.\\d{3}-[\\dkK])$/.test(rut)\n\n// Formateo automático RUT mientras se escribe\nconst formatRut = () => {\n  let rut = newCompany.value.rut.replace(/[^0-9kK]/g, '')\n  if (rut.length > 9) rut = rut.slice(0, 9)\n\n  if (rut.length > 1) {\n    const body = rut.slice(0, -1)\n    const dv = rut.slice(-1)\n    const reversed = body.split('').reverse()\n    const withDots = []\n    reversed.forEach((char, i) => { if (i > 0 && i % 3 === 0) withDots.push('.'); withDots.push(char) })\n    newCompany.value.rut = withDots.reverse().join('') + '-' + dv\n  } else {\n    newCompany.value.rut = rut\n  }\n}\n\n// Validación paso 1: todos los campos requeridos + RUT válido\nconst isStep1Valid = computed(() => {\n  const { name, rut, contact, city } = newCompany.value\n  return name.trim() && rut.trim() && contact.trim() && city.trim() && isValidRut(rut)\n})\n\n// Navegación\nconst goToNextStep = () => {\n  if (isStep1Valid.value) step.value = 2\n  else alert('Completa todos los campos correctamente antes de continuar.')\n}\n\n// Envío de la nueva empresa\nconst submitAddCompany = () => {\n  if (!selectedTemplate.value) return // Doble chequeo, aunque el botón debería estar deshabilitado\n\n  // Enviamos los datos al padre para que él se encargue de la lógica de guardado y manejo de array\n  emit('add-company', { ...newCompany.value, templateId: selectedTemplate.value })\n  \n  // Resetear el estado del modal (simula el 'cancel' del padre)\n  step.value = 1\n  selectedTemplate.value = null\n  newCompany.value = { name: '', rut: '', contact: '', city: '' }\n}\n\n\n// Computed para texto dinámico de botones en modal\nconst modalButtonText = computed(() => step.value === 1 ? 'Siguiente' : 'Crear Empresa')\nconst isModalButtonDisabled = computed(() => step.value === 2 && !selectedTemplate.value)\n\n// Watcher para resetear el estado del modal cuando se oculta\nwatch(() => props.showAddModal, (newValue) => {\n  if (!newValue) {\n    // Resetear el estado al cerrar\n    step.value = 1\n    selectedTemplate.value = null\n    newCompany.value = { name: '', rut: '', contact: '', city: '' }\n  }\n})\n</script>\n\n<style scoped>\n/* Estilos y transiciones específicos del modal si los hay */\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}