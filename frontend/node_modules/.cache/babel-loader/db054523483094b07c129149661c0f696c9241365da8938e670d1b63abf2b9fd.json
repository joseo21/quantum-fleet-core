{"ast":null,"code":"import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"p-2\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode($setup[\"MantencionesTable\"], {\n    mantenciones: $setup.mantenciones,\n    onVerMantenciones: $setup.verMantenciones,\n    onAgregarMantencion: $setup.abrirModal\n  }, null, 8 /* PROPS */, [\"mantenciones\"]), _createVNode($setup[\"ModalAgregar\"], {\n    \"show-add-modal\": $setup.showAddModal,\n    \"selected-patente\": $setup.patenteSeleccionada,\n    mantenciones: $setup.mantencionesPorPatente[$setup.patenteSeleccionada] || [],\n    \"selected-mantencion\": $setup.mantencionSeleccionada,\n    onClose: $setup.cerrarModal,\n    onSave: $setup.guardarMantencion\n  }, null, 8 /* PROPS */, [\"show-add-modal\", \"selected-patente\", \"mantenciones\", \"selected-mantencion\"]), $setup.showVerModal ? (_openBlock(), _createBlock($setup[\"ModalVerMantenciones\"], {\n    key: 0,\n    patente: $setup.patenteSeleccionada,\n    mantenciones: $setup.mantencionesPorPatente[$setup.patenteSeleccionada] || [],\n    onClose: _cache[0] || (_cache[0] = $event => $setup.showVerModal = false),\n    onEditar: $setup.editarMantencion,\n    onEliminar: $setup.eliminarMantencion\n  }, null, 8 /* PROPS */, [\"patente\", \"mantenciones\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","$setup","mantenciones","onVerMantenciones","verMantenciones","onAgregarMantencion","abrirModal","showAddModal","patenteSeleccionada","mantencionesPorPatente","mantencionSeleccionada","onClose","cerrarModal","onSave","guardarMantencion","showVerModal","_createBlock","patente","_cache","$event","onEditar","editarMantencion","onEliminar","eliminarMantencion"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/Views/MantencionesView.vue"],"sourcesContent":["<template>\n  <div class=\"p-2\">\n    <MantencionesTable :mantenciones=\"mantenciones\" @ver-mantenciones=\"verMantenciones\"\n      @agregar-mantencion=\"abrirModal\" />\n\n    <ModalAgregar :show-add-modal=\"showAddModal\" :selected-patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\" :selected-mantencion=\"mantencionSeleccionada\"\n      @close=\"cerrarModal\" @save=\"guardarMantencion\" />\n\n    <ModalVerMantenciones v-if=\"showVerModal\" :patente=\"patenteSeleccionada\"\n      :mantenciones=\"mantencionesPorPatente[patenteSeleccionada] || []\" @close=\"showVerModal = false\"\n      @editar=\"editarMantencion\" @eliminar=\"eliminarMantencion\" />\n\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue'\nimport MantencionesTable from '@/components/MantencionesUi/MantencionesTable.vue'\nimport ModalAgregar from '@/components/MantencionesUi/ModalAgregar.vue'\nimport ModalVerMantenciones from '@/components/MantencionesUi/ModalVerMantenciones.vue'\n\nconst patenteSeleccionada = ref('')\nconst selectedVehiculo = ref(null)\nconst mantencionSeleccionada = ref(null) // Para editar\n\nconst showAddModal = ref(false)\nconst showVerModal = ref(false)\n\n// ✅ Usar reactive en lugar de ref\nconst mantencionesPorPatente = reactive({})\n\n// Lista inicial de vehículos\nconst mantenciones = ref([\n  { patente: 'ABC123', odometro: 4500, estado: 'OK' },\n  { patente: 'XYZ789', odometro: 72000, estado: 'Requiere mantención' },\n  { patente: 'DEF456', odometro: 60000, estado: 'Próxima mantención' },\n])\n\nfunction abrirModal(item) {\n  selectedVehiculo.value = item\n  patenteSeleccionada.value = item.patente\n\n  if (!mantencionesPorPatente[item.patente]) {\n    mantencionesPorPatente[item.patente] = []\n  }\n\n  mantencionSeleccionada.value = null\n  showAddModal.value = true\n}\n\n\nfunction cerrarModal() {\n  showAddModal.value = false\n  selectedVehiculo.value = null\n  mantencionSeleccionada.value = null\n}\n\nfunction verMantenciones(item) {\n  patenteSeleccionada.value = item.patente\n  showVerModal.value = true\n}\n\n// Guardar mantención (nuevo o editar)\nfunction guardarMantencion(maintenance) {\n  const patente = patenteSeleccionada.value\n  console.log('[Padre] guardarMantencion →', patente, maintenance)\n\n  // Crear array reactivamente si no existe\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n    console.log('[Padre] creada lista para', patente)\n  }\n\n  const mantencionesVehiculo = mantencionesPorPatente[patente]\n  const editingIndex = mantencionSeleccionada.value\n\n\n\n  // Guardar (nuevo o editado)\n  if (editingIndex !== null) {\n    console.log('[Padre] editando índice', editingIndex)\n    mantencionesVehiculo[editingIndex] = maintenance\n  } else {\n    console.log('[Padre] agregando nueva mantención')\n    mantencionesVehiculo.push(maintenance)\n  }\n\n  console.log('[Padre] mantencionesPorPatente actual:', JSON.parse(JSON.stringify(mantencionesPorPatente)))\n  cerrarModal()\n}\n\n\n\n// Editar desde ModalVerMantenciones\nfunction editarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n\n  if (!mantencionesPorPatente[patente]) {\n    mantencionesPorPatente[patente] = []\n  }\n\n  mantencionSeleccionada.value = idx\n  selectedVehiculo.value = { patente, odometro: selectedVehiculo.value?.odometro || 0 }\n  showAddModal.value = true\n}\n\n// Eliminar desde ModalVerMantenciones\nfunction eliminarMantencion(idx) {\n  const patente = patenteSeleccionada.value\n  mantencionesPorPatente[patente].splice(idx, 1)\n}\n</script>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAK;;uBAAhBC,mBAAA,CAYM,OAZNC,UAYM,GAXJC,YAAA,CACqCC,MAAA;IADjBC,YAAY,EAAED,MAAA,CAAAC,YAAY;IAAGC,iBAAgB,EAAEF,MAAA,CAAAG,eAAe;IAC/EC,mBAAkB,EAAEJ,MAAA,CAAAK;6CAEvBN,YAAA,CAEmDC,MAAA;IAFpC,gBAAc,EAAEA,MAAA,CAAAM,YAAY;IAAG,kBAAgB,EAAEN,MAAA,CAAAO,mBAAmB;IAChFN,YAAY,EAAED,MAAA,CAAAQ,sBAAsB,CAACR,MAAA,CAAAO,mBAAmB;IAAU,qBAAmB,EAAEP,MAAA,CAAAS,sBAAsB;IAC7GC,OAAK,EAAEV,MAAA,CAAAW,WAAW;IAAGC,MAAI,EAAEZ,MAAA,CAAAa;0GAEFb,MAAA,CAAAc,YAAY,I,cAAxCC,YAAA,CAE8Df,MAAA;;IAFnBgB,OAAO,EAAEhB,MAAA,CAAAO,mBAAmB;IACpEN,YAAY,EAAED,MAAA,CAAAQ,sBAAsB,CAACR,MAAA,CAAAO,mBAAmB;IAAUG,OAAK,EAAAO,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAElB,MAAA,CAAAc,YAAY;IACrFK,QAAM,EAAEnB,MAAA,CAAAoB,gBAAgB;IAAGC,UAAQ,EAAErB,MAAA,CAAAsB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}