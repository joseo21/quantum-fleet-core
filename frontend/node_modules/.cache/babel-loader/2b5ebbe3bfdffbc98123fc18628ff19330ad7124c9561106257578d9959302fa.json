{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nexport default {\n  name: \"ModalVerMantenciones\",\n  props: {\n    patente: String,\n    mantenciones: Array\n  },\n  computed: {\n    mantencionesConEstado() {\n      return this.mantenciones.map(m => {\n        let umbral;\n        let faltante;\n        let estado = \"OK\";\n        if (m.tipo === \"Por Odómetro\") {\n          const ultimo = Number(m.ultimo) || 0;\n          const actual = Number(m.actual) || 0;\n          const intervalo = Number(m.intervalo) || 0;\n          const alerta = Number(m.alerta) || 0;\n          umbral = ultimo + intervalo;\n          faltante = umbral - actual;\n          if (faltante <= 0) estado = \"Requiere mantención\";else if (faltante <= alerta) estado = \"Próxima mantención\";\n        } else if (m.tipo === \"Por Tiempo\") {\n          if (m.ultimo && typeof m.ultimo === \"string\" && m.ultimo.includes(\"-\")) {\n            const [yyyy, mm, dd] = m.ultimo.split(\"-\");\n            const ultimaFecha = new Date(yyyy, mm - 1, dd);\n            const intervaloDias = Number(m.intervalo) || 0;\n            const umbralDate = new Date(ultimaFecha.getFullYear(), ultimaFecha.getMonth(), ultimaFecha.getDate() + intervaloDias);\n            faltante = Math.ceil((umbralDate - new Date()) / (1000 * 60 * 60 * 24));\n            const alerta = Number(m.alerta) || 0;\n            if (faltante <= 0) estado = \"Requiere mantención\";else if (faltante <= alerta) estado = \"Próxima mantención\";\n            umbral = umbralDate.toISOString().split(\"T\")[0];\n          } else {\n            umbral = \"N/A\";\n            faltante = \"N/A\";\n            estado = \"Datos incompletos\";\n          }\n        }\n        return {\n          ...m,\n          umbral,\n          faltante,\n          estado\n        };\n      });\n    }\n  }\n};","map":{"version":3,"names":["name","props","patente","String","mantenciones","Array","computed","mantencionesConEstado","map","m","umbral","faltante","estado","tipo","ultimo","Number","actual","intervalo","alerta","includes","yyyy","mm","dd","split","ultimaFecha","Date","intervaloDias","umbralDate","getFullYear","getMonth","getDate","Math","ceil","toISOString"],"sources":["/home/sebastian/quantum-fleet-core/frontend/src/components/MantencionesUi/ModalVerMantenciones.vue"],"sourcesContent":["<template>\n  <div class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n    <div class=\"bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 rounded-lg w-full max-w-4xl p-6\">\n      <h2 class=\"text-xl font-bold mb-4 text-center\">\n        Mantenciones de {{ patente }}\n      </h2>\n\n      <div v-if=\"mantenciones.length === 0\" class=\"text-center text-gray-500\">\n        No hay mantenciones registradas para este vehículo.\n      </div>\n\n      <table v-else class=\"w-full border border-gray-300 dark:border-gray-700 rounded-lg overflow-hidden text-sm\">\n        <thead class=\"bg-gray-100 dark:bg-gray-800\">\n          <tr>\n            <th class=\"py-2 px-3 text-left\">Nombre</th>\n            <th class=\"py-2 px-3 text-left\">Tipo</th>\n            <th class=\"py-2 px-3 text-center\">Último</th>\n            <th class=\"py-2 px-3 text-center\">Intervalo</th>\n            <th class=\"py-2 px-3 text-center\">Alerta</th>\n            <th class=\"py-2 px-3 text-center\">Umbral</th>\n            <th class=\"py-2 px-3 text-center\">Faltante</th>\n            <th class=\"py-2 px-3 text-center\">Estado</th>\n            <th class=\"py-2 px-3 text-center\">Acciones</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(m, idx) in mantencionesConEstado\" :key=\"idx\" class=\"border-t dark:border-gray-700\">\n            <td class=\"py-2 px-3\">{{ m.nombre }}</td>\n            <td class=\"py-2 px-3\">{{ m.tipo }}</td>\n            <td class=\"py-2 px-3 text-center\">{{ m.ultimo }}</td>\n            <td class=\"py-2 px-3 text-center\">{{ m.intervalo }}</td>\n            <td class=\"py-2 px-3 text-center\">{{ m.alerta }}</td>\n            <td class=\"py-2 px-3 text-center\">{{ m.umbral }}</td>\n            <td class=\"py-2 px-3 text-center\">{{ m.faltante }}</td>\n\n            <td class=\"py-2 px-3 text-center\">\n              <div class=\"flex items-center justify-center\">\n                <img v-if=\"m.estado === 'OK'\"\n                     src=\"https://sinergygroup.cl/Mantenciones/img/verde.png\"\n                     class=\"w-10 h-10 object-contain\" />\n                <img v-else-if=\"m.estado === 'Próxima mantención'\"\n                     src=\"https://sinergygroup.cl/Mantenciones/img/amarillo.png\"\n                     class=\"w-10 h-10 object-contain\" />\n                <img v-else-if=\"m.estado === 'Requiere mantención'\"\n                     src=\"https://sinergygroup.cl/Mantenciones/img/rojo.png\"\n                     class=\"w-10 h-10 object-contain\" />\n                <span v-else>{{ m.estado }}</span>\n              </div>\n            </td>\n\n            <td class=\"py-2 px-3 text-center\">\n              <button @click=\"$emit('editar', idx)\" class=\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded mr-2\">\n                Editar\n              </button>\n              <button @click=\"$emit('eliminar', idx)\" class=\"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded\">\n                Eliminar\n              </button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n\n      <div class=\"mt-4 text-center\">\n        <button @click=\"$emit('close')\" class=\"bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded\">\n          Cerrar\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"ModalVerMantenciones\",\n  props: {\n    patente: String,\n    mantenciones: Array\n  },\n\n  computed: {\n    mantencionesConEstado() {\n      return this.mantenciones.map(m => {\n        let umbral;\n        let faltante;\n        let estado = \"OK\";\n\n        if (m.tipo === \"Por Odómetro\") {\n          const ultimo = Number(m.ultimo) || 0;\n          const actual = Number(m.actual) || 0;\n          const intervalo = Number(m.intervalo) || 0;\n          const alerta = Number(m.alerta) || 0;\n\n          umbral = ultimo + intervalo;\n          faltante = umbral - actual;\n\n          if (faltante <= 0) estado = \"Requiere mantención\";\n          else if (faltante <= alerta) estado = \"Próxima mantención\";\n        } \n        else if (m.tipo === \"Por Tiempo\") {\n          if (m.ultimo && typeof m.ultimo === \"string\" && m.ultimo.includes(\"-\")) {\n            const [yyyy, mm, dd] = m.ultimo.split(\"-\");\n            const ultimaFecha = new Date(yyyy, mm - 1, dd);\n            const intervaloDias = Number(m.intervalo) || 0;\n            const umbralDate = new Date(\n              ultimaFecha.getFullYear(),\n              ultimaFecha.getMonth(),\n              ultimaFecha.getDate() + intervaloDias\n            );\n\n            faltante = Math.ceil((umbralDate - new Date()) / (1000 * 60 * 60 * 24));\n            const alerta = Number(m.alerta) || 0;\n\n            if (faltante <= 0) estado = \"Requiere mantención\";\n            else if (faltante <= alerta) estado = \"Próxima mantención\";\n\n            umbral = umbralDate.toISOString().split(\"T\")[0];\n          } else {\n            umbral = \"N/A\";\n            faltante = \"N/A\";\n            estado = \"Datos incompletos\";\n          }\n        }\n\n        return { ...m, umbral, faltante, estado };\n      });\n    }\n  }\n};\n</script>\n"],"mappings":";;AAwEA,eAAe;EACbA,IAAI,EAAE,sBAAsB;EAC5BC,KAAK,EAAE;IACLC,OAAO,EAAEC,MAAM;IACfC,YAAY,EAAEC;EAChB,CAAC;EAEDC,QAAQ,EAAE;IACRC,qBAAqBA,CAAA,EAAG;MACtB,OAAO,IAAI,CAACH,YAAY,CAACI,GAAG,CAACC,CAAA,IAAK;QAChC,IAAIC,MAAM;QACV,IAAIC,QAAQ;QACZ,IAAIC,MAAK,GAAI,IAAI;QAEjB,IAAIH,CAAC,CAACI,IAAG,KAAM,cAAc,EAAE;UAC7B,MAAMC,MAAK,GAAIC,MAAM,CAACN,CAAC,CAACK,MAAM,KAAK,CAAC;UACpC,MAAME,MAAK,GAAID,MAAM,CAACN,CAAC,CAACO,MAAM,KAAK,CAAC;UACpC,MAAMC,SAAQ,GAAIF,MAAM,CAACN,CAAC,CAACQ,SAAS,KAAK,CAAC;UAC1C,MAAMC,MAAK,GAAIH,MAAM,CAACN,CAAC,CAACS,MAAM,KAAK,CAAC;UAEpCR,MAAK,GAAII,MAAK,GAAIG,SAAS;UAC3BN,QAAO,GAAID,MAAK,GAAIM,MAAM;UAE1B,IAAIL,QAAO,IAAK,CAAC,EAAEC,MAAK,GAAI,qBAAqB,MAC5C,IAAID,QAAO,IAAKO,MAAM,EAAEN,MAAK,GAAI,oBAAoB;QAC5D,OACK,IAAIH,CAAC,CAACI,IAAG,KAAM,YAAY,EAAE;UAChC,IAAIJ,CAAC,CAACK,MAAK,IAAK,OAAOL,CAAC,CAACK,MAAK,KAAM,QAAO,IAAKL,CAAC,CAACK,MAAM,CAACK,QAAQ,CAAC,GAAG,CAAC,EAAE;YACtE,MAAM,CAACC,IAAI,EAAEC,EAAE,EAAEC,EAAE,IAAIb,CAAC,CAACK,MAAM,CAACS,KAAK,CAAC,GAAG,CAAC;YAC1C,MAAMC,WAAU,GAAI,IAAIC,IAAI,CAACL,IAAI,EAAEC,EAAC,GAAI,CAAC,EAAEC,EAAE,CAAC;YAC9C,MAAMI,aAAY,GAAIX,MAAM,CAACN,CAAC,CAACQ,SAAS,KAAK,CAAC;YAC9C,MAAMU,UAAS,GAAI,IAAIF,IAAI,CACzBD,WAAW,CAACI,WAAW,CAAC,CAAC,EACzBJ,WAAW,CAACK,QAAQ,CAAC,CAAC,EACtBL,WAAW,CAACM,OAAO,CAAC,IAAIJ,aAC1B,CAAC;YAEDf,QAAO,GAAIoB,IAAI,CAACC,IAAI,CAAC,CAACL,UAAS,GAAI,IAAIF,IAAI,CAAC,CAAC,KAAK,IAAG,GAAI,EAAC,GAAI,EAAC,GAAI,EAAE,CAAC,CAAC;YACvE,MAAMP,MAAK,GAAIH,MAAM,CAACN,CAAC,CAACS,MAAM,KAAK,CAAC;YAEpC,IAAIP,QAAO,IAAK,CAAC,EAAEC,MAAK,GAAI,qBAAqB,MAC5C,IAAID,QAAO,IAAKO,MAAM,EAAEN,MAAK,GAAI,oBAAoB;YAE1DF,MAAK,GAAIiB,UAAU,CAACM,WAAW,CAAC,CAAC,CAACV,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;UACjD,OAAO;YACLb,MAAK,GAAI,KAAK;YACdC,QAAO,GAAI,KAAK;YAChBC,MAAK,GAAI,mBAAmB;UAC9B;QACF;QAEA,OAAO;UAAE,GAAGH,CAAC;UAAEC,MAAM;UAAEC,QAAQ;UAAEC;QAAO,CAAC;MAC3C,CAAC,CAAC;IACJ;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}